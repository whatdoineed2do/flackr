<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />

    <script type='text/javascript' src="/js/jquery.min.js"></script>
    <link rel="stylesheet" href="/css/justifiedGallery.min.css"/>
    <script type='text/javascript' src="/js/jquery.justifiedGallery.min.js"></script>

    <link rel="stylesheet" href="/css/flackr.css"/>

    <script>
      var album_ttl = -1;
    </script>

    <style>
      img {
        object-fit: cover;
        border-radius: 5px;
        width: 150px;
        height: 150px;
      }

      .container {
        flex-direction: column;
        flex-flow: row;
        display: flex;
      }
      .column {
        flex: 1;
      }
      .row {
        flex-wrap: wrap;
        display: flex;
      }
      .card {
        padding: 10px;
        background-color: white;
      }
    </style>
  </head>

  <body>
    <div class="header">
      <a href="/flickr" class="logo">flackr</a>
      <div class="header-right">
        <a class="active" id="total">loading...</a>
        <a id="loaded"></a>
      </div>
    </div> 

    <div class="content" style="margin: 10px; padding: 20px;">
      <div class="container">
      <div class="row">
      <a id="albums">placeholder</a>

      <script type="text/javascript">
        function fetchalbums() {
          // this call needs to be sync!!!
          $.ajax({
            url: "/cgi-bin/flickr-dirs.sh",
            data: { where: location.pathname },
            type: "GET",
            async: false,
            success: function(resp){
              var data = resp;
  console.log("resp: count=" + data.count + " ttl=" + data.total_imgs);
              $("#albums").text('');
              for (var i=0; i<data.albums.length; i++) {
                var obj = data.albums[i];
                $("#albums").append(
'<div class="card">' +
' <div class="column">' +
'  <a href="' + obj.path + '">' +
'  <div class="row">' +
'   <div class="card-cover">' +
'    <img src="' + obj.thumbpath + '"/>' +
'   </div>' +
'  </div>' +
'  <div class="row">' +
'   <div class="card-meta">' +
'    <h2>' + obj.name + '</h2>' +
'    <a>' + obj.total + ' images</a>' +
'   </div>' +
'  </div>' +
'  </a>'+
' </div>' +
'</div>');
              }
              if (album_ttl < 0) {
                album_ttl = data.count
              }
              $("#total").text(album_ttl + ' albums');
            }
          });
        }

        fetchalbums();
    </script>
      </div>
    </div>
    </div>
  </div>
  </body>
</html>
